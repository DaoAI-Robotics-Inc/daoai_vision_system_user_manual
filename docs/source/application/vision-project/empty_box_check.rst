Empty Box Check
=================

本章会详细介绍如何设置 Empty Box Check 功能。

Empty Box Check 是一种查看ROI中是否存在物体的方法，主要用于保护场景材料、设备和人身安全的重要判断条件。自动化场景中，系统会根据大量条件判断状态机、流程的变化。
当场景中仍然存在物体、工件、障碍物，系统却无法获得该信号时，可能会导致机械设备、零件或者人身安全。

Empty Box Check 功能存在于所有的检测流程，不管你是使用任意的检测流程，都可以使用此功能。

1. 重新设置ROI
-------------------
使用Empty Box Check功能，你有可能需要重新设置你的ROI。通常情况下，在设置ROI时都会把物体的背景涵括在内，就像下图显示一样（下图的桌面）。不过，当你想要使用Empty Box Check 功能时，你需要把背景分割开。

    .. image:: images/allroi.png
        :scale: 65%

|

这样做的原因是由于Empty Box Check 功能的原理：此功能是判断ROI中是否存在连续的有效点云，若ROI中有存在超过2000个连续点云的区域，系统则会判断场景中存在物体：Not Empty Box。
反之，当场景中没有存在超过2000个连续点云的区域，系统则会判断场景中没有存在物体：Empty Box。

所以，你需要把ROI重新设置到背景的上方，要把背景的点云排除在外。如下图显示，设置ROI在背景外。

    .. image:: images/excludeROI.png
        :scale: 65%

|

其余的任务选项无需修改。

|

2. 发送Empty Box Check 检查指令
--------------------------------

在deploy后，连接机器人和相机，使用机器人发送Empty Box Check 指令。详情可查阅：:ref:`TODO`

发送Empty Box Check 指令，系统会拍照、检测，并在console上显示结果。下图显示，判断结果为Not Empty，ROI中存在连续有效点云。

    .. image:: images/notempty.png
        :scale: 85%

|

下图显示，判断结果为 Empty，ROI中没有连续有效点云。

    .. image:: images/empty.png
        :scale: 85%

|

3. 实际案例
-----------

在某工厂的自动化流水线上，生产着烟雾探测警报器。机器人会把乱序、随机拜访的烟雾报警器从箱子中取出，放置到自动包装线上。在每个箱子中的工件（烟雾报警器）抓取完毕后，另一机械结构会把空箱子叠到旁边，开始继续抓取下一个箱子。

    .. image:: images/smoked.png
        :scale: 65%

|

如上图显示，部分烟雾报警器会竖立在箱子的边缘，导致系统无法识别的烟感器：探测结果为：0个工件。如果此时，机械结构把该箱子叠到旁边，那么就会有工件仍然在箱子中。在后续叠上的箱子则会导致：工件损坏、箱子损坏、机械结构损坏、自动化进程暂停，甚至严重会引起设备、箱子倒塌，引起工作人员的人身安全。

那么，系统无法识别出工件时，我们就需要另一个判断，反馈到系统，告诉系统箱子中仍有物体，请检查、或者人工干预。

Empty Box Check 功能很好的处理了该事宜，发送是否Empty的信号，请求人工干预或者震动，使系统安全地运行。