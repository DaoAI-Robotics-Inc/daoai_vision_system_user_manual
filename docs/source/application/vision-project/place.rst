物体放置（Placement）
===========================

本章会详细介绍如何设置 物体放置（Placement） 检测流程。

    .. image:: images/place.png
        :scale: 100%

物体放置（Placement）用于在物体放置位置会变化时使用，该流程在定义时会记录初始的放置位置，并在之后部署时，返回当前放置位置相对于初始放置位置的偏移量，并由机器人端计算并放置物体。

该流程通常和 :ref:`物体姿态修正（In-Hand Adjustment）` 流程一起使用。


1. 手眼标定
----------------

在创建任务时，需要有已经连接的相机和机器人，然后选择手眼标定文件。如果您还没有完成手眼标定，请参考 :ref:`机器人手眼标定` 来完成手眼标定。

2. 上传深度学习模型
-------------------

    .. image:: images/place_upload_model.png
        :scale: 90%

|

点击上传来浏览深度学习的 ``.zip`` 文件。等上传完成后，点击 ``保存模型`` 。

（可选）点击 ``测试模型`` ，来拍照并预览深度学习预测结果。

    .. image:: images/test_dl_place.png
        :scale: 70%

|


3. 配置检测流程
------------------

物体放置（Placement） 的检测流程和 半有序快速关键点 （Semi-Ordered Fast Keypoint） 的检测流程相同。

1. 首先，点击拍照按钮给场景拍照，确认相机正常工作，以及确认物体位置，相机视野是否合适。

    .. image:: images/place_detect.png
        :scale: 70%

|

2. 点击设置ROI, 使用窗口中的框截选出检测区域，这一步是为了移除背景，等干扰点云，只保留物体点云会出现的区域，这样可以使检测更快更准。这一步同时设置了参考系，ROI的坐标就是参考系。

    .. image:: images/place_roi.png
        :scale: 70%

|

    .. tip::
        您也可以框选使得物体所在的平面也被移除，这样只保留物体的点云会最大程度的提高检测速度以及准确度。

    .. note::
        ROI的箱体需要和抓取平面保持平行，因为ROI同时设置了参考系，ROI的坐标就是参考系。当之后设置夹爪从上方抓取时，就会以这里定义的参考系的 z 轴为上方。Pick sort的对齐x,y 旋转 也是以参考系为基准。

3. 检查显示窗口的ROI截取的点云是否合适，如果需要修改ROI，请重复1，2，重新设置ROI.

4. 然后就需要定义检测模型，点击开始，然后在右侧物体标签列选中要进行定义的物体标签，在场景中间摆放一个物体，然后点击拍照。

    .. image:: images/place_define_model_1.png
        :scale: 65%

|

5. 点击设置ROI, 使用显示窗口中的ROI工具，将物体点云框出来，这一步需要只包含物体点云部分，并去除任何不属于物体的部分，然后点击定义模型。

    .. image:: images/place_define_model_2.png
        :scale: 65%

.. tip::
    物体模型如果是像当前例子里类似，属于是一个大平面上的若干特征点，那么点云模型如果只定义为截取平面的一部分，那么点云的几何特征就近乎是没有。|br|
    可以将放置图案像上面的例子中垫高一部分，创造点云的几何特征。这样点云匹配才会准确。


|

6. 点击优化模型，然后点击 '>' 箭头开始下一步，选择参考点，然后点击保存。参考点的方式有以下两种:
    1. 选择参考点为所有关键点的中心
    2. 选择其中一个关键点作为物体的参考点

    .. image:: images/place_refine_model.png
        :scale: 65%

|

7. (可选) 调试高级设置，更多高级设置详情，请阅读 :ref:`半有序快速关键点 （Semi-Ordered Fast Keypoint） 检测流程高级配置`。 物体放置（Placement） 的检测流程和 半有序快速关键点 （Semi-Ordered Fast Keypoint） 的检测流程相同。

8. 切换到快速检测栏，点击快速检测，下图中绿色部分就是物体模型检测后的结果，请确保物体能够被正确的检测到。如果您的检测效果不佳，请检查1-9的步骤是否正确，更多请阅读 :ref:`视觉项目优化`

    .. image:: images/place_quick_detect.png
        :scale: 65%

|

这样检测部分就设置好了，物体放置（Placement） 不需要配置抓取步骤，配置好对应的放置直接部署即可。

物体放置（Placement）和 物体姿态修正（In-Hand Adjustment）需要在机器人端执行示教步骤，详情请参考 :ref:`物体姿态修正和放置部署示例`

.. |br| raw:: html

      <br>